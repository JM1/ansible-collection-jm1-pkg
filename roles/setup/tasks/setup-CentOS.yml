---
# Copyright (c) 2020-2022 Jakob Meng, <jakobmeng@web.de>
# vim:set fileformat=unix tabstop=2 shiftwidth=2 expandtab:
# kate: end-of-line unix; space-indent on; indent-width 2; remove-trailing-spaces modified;

# NOTE: Synchronize changes with README.md

- name: Enable Extra Packages for Enterprise Linux (EPEL) repository
  # Ref.: https://docs.fedoraproject.org/en-US/epel/
  block:
  - name: Setup EPEL repository for Red Hat Enterprise Linux
    when: distribution_id|first == 'Red Hat Enterprise Linux'
    yum:
      disable_gpg_check: yes
      name:
      - 'https://dl.fedoraproject.org/pub/epel/epel-release-latest-{{ distribution_id|last }}.noarch.rpm'

  - name: Setup EPEL repository for CentOS 7 and CentOS 8
    when: distribution_id|first == 'CentOS' and distribution_id|last in ['7', '8']
    block:
    - package:
        name:
        - epel-release
    - when: distribution_release == 'Stream'
      # Distinction between Stream and Core in distribution_release since Ansible 2.11
      # Ref.: https://github.com/ansible/ansible/commit/7f0eb7ad799e531a8fbe5cc4f46046a4b1aeb093
      package:
        name:
        - epel-next-release

  - name: Setup EPEL repository for CentOS 9
    when: distribution_id|first == 'CentOS' and distribution_id|last == '9'
    block:
    - dnf:
        disable_gpg_check: yes
        name:
        - 'https://dl.fedoraproject.org/pub/epel/epel-release-latest-{{ distribution_id|last }}.noarch.rpm'
    - dnf:
        disable_gpg_check: yes
        name:
        - 'https://dl.fedoraproject.org/pub/epel/epel-next-release-latest-{{ distribution_id|last }}.noarch.rpm'

- name: Satisfy requirements for collection jm1.pkg on Red Hat Enterprise Linux 7 and CentOS 7
  when: distribution_id|last == '7'
  block:
  - name: Install package dependencies for Red Hat Enterprise Linux 7 and CentOS 7
    package:
      name:
      # NOTE: Keep in sync with meta package below!
      - python-babel
      - python-backports
      - python-jinja2
      - python-pip
      - rpm-build

  - name: Install pip dependencies for Red Hat Enterprise Linux 7 and CentOS 7
    block:
    - pip:
        name: backports.tempfile

  - name: Install supplemental meta package
    jm1.pkg.meta_pkg:
      name: "jm1-pkg-setup"
      version: "3"
      depends:
      - python-babel
      - python-backports
      - python-jinja2
      - python-pip
      - rpm-build

- name: Satisfy requirements for collection jm1.pkg on Red Hat Enterprise Linux 8 and 9 and CentOS 8 and 9
  when: distribution_id|last in ['8', '9']
  block:
  - name: Install package dependencies for Red Hat Enterprise Linux 8 and 9 and CentOS 8 and 9
    package:
      name:
      # NOTE: Keep in sync with meta package below!
      - python3-babel
      - python3-dnf
      - python3-jinja2
      - rpm-build

  - name: Install supplemental meta package
    jm1.pkg.meta_pkg:
      name: "jm1-pkg-setup"
      version: "3"
      depends:
      - python3-babel
      - python3-dnf
      - python3-jinja2
      - rpm-build
